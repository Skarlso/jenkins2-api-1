<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>


    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="./LICENSE.html">LICENSE</a>
  
    <li><a href="./README_md.html">README</a>
  
  </ul>
</div>

    <div id="classindex-section" class="nav-section">
  <h3>Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Jenkins2API.html">Jenkins2API</a>
  
    <li><a href="./Jenkins2API/Client.html">Jenkins2API::Client</a>
  
    <li><a href="./Jenkins2API/Command.html">Jenkins2API::Command</a>
  
    <li><a href="./Jenkins2API/Command/Build.html">Jenkins2API::Command::Build</a>
  
    <li><a href="./Jenkins2API/Command/Job.html">Jenkins2API::Command::Job</a>
  
    <li><a href="./Jenkins2API/Command/Node.html">Jenkins2API::Command::Node</a>
  
    <li><a href="./Jenkins2API/Endpoint.html">Jenkins2API::Endpoint</a>
  
    <li><a href="./Jenkins2API/Endpoint/Artifact.html">Jenkins2API::Endpoint::Artifact</a>
  
    <li><a href="./Jenkins2API/Endpoint/BaseEndpoint.html">Jenkins2API::Endpoint::BaseEndpoint</a>
  
    <li><a href="./Jenkins2API/Endpoint/Build.html">Jenkins2API::Endpoint::Build</a>
  
    <li><a href="./Jenkins2API/Endpoint/Job.html">Jenkins2API::Endpoint::Job</a>
  
    <li><a href="./Jenkins2API/Endpoint/Node.html">Jenkins2API::Endpoint::Node</a>
  
    <li><a href="./Jenkins2API/ThorCommand.html">Jenkins2API::ThorCommand</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main">


<p><a href="https://badge.fury.io/rb/jenkins2-api"><img
src="https://badge.fury.io/rb/jenkins2-api.svg"></a> <a
href="https://travis-ci.org/Yitsushi/jenkins2-api"><img
src="https://travis-ci.org/Yitsushi/jenkins2-api.svg?branch=master"></a></p>

<h1 id="label-API+Client+for+Jenkins2">API Client for Jenkins2<span><a href="#label-API+Client+for+Jenkins2">&para;</a> <a href="#top">&uarr;</a></span></h1>

<h2 id="label-Install">Install<span><a href="#label-Install">&para;</a> <a href="#top">&uarr;</a></span></h2>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-identifier">install</span> <span class="ruby-identifier">jenkins2</span><span class="ruby-operator">-</span><span class="ruby-identifier">api</span>
</pre>

<h2 id="label-Executable">Executable<span><a href="#label-Executable">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>You can specify server and credentials with parameters:</p>

<pre class="ruby"><span class="ruby-operator">-</span><span class="ruby-operator">-</span><span class="ruby-identifier">password</span>
<span class="ruby-operator">-</span><span class="ruby-operator">-</span><span class="ruby-identifier">username</span>
<span class="ruby-operator">-</span><span class="ruby-operator">-</span><span class="ruby-identifier">server</span>
</pre>

<p>Or with environment variables:</p>

<pre class="ruby"><span class="ruby-constant">JENKINS_SERVER</span>=<span class="ruby-string">&#39;&#39;</span>
<span class="ruby-constant">JENKINS_USERNAME</span>=<span class="ruby-string">&#39;&#39;</span>
<span class="ruby-constant">JENKINS_PASSWORD</span>=<span class="ruby-string">&#39;&#39;</span>
</pre>

<p>Password can be a password or an API token from
<code>/user/{user}/configure</code></p>

<h3 id="label-List+computers+-2F+nodes">List computers / nodes<span><a href="#label-List+computers+-2F+nodes">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-comment"># List all nodes</span>
<span class="ruby-identifier">jenkins2api</span> <span class="ruby-identifier">node</span> <span class="ruby-identifier">all</span>

<span class="ruby-comment"># Only slaves</span>
<span class="ruby-identifier">jenkins2api</span> <span class="ruby-identifier">node</span> <span class="ruby-identifier">slaves</span>
</pre>

<h3 id="label-Get+the+name+of+the+slave+where+a+build+was+executed">Get the name of the slave where a build was executed<span><a href="#label-Get+the+name+of+the+slave+where+a+build+was+executed">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre>jenkins2api build slave-name jobname buildid</pre>

<p>If you build slave names contain an AWS EC2 ID, you you add
<code>--ec2id</code> parameter to match for it and then it will print out
only the ec2 instance id.</p>

<pre>jenkins2api build slave-name jobname buildid --ec2id</pre>

<h2 id="label-Ruby+side">Ruby side<span><a href="#label-Ruby+side">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>All response are a generic Jenkins response. There are no wrapper classes
around them.</p>

<p>Create a new client:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;jenkins2-api&#39;</span>

<span class="ruby-identifier">client</span> = <span class="ruby-constant">Jenkins2API</span><span class="ruby-operator">::</span><span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(
  :<span class="ruby-identifier">server</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;http://jenkins.example.com/&#39;</span>,
  :<span class="ruby-identifier">username</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;myusername&#39;</span>,
  :<span class="ruby-identifier">password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;myapitoken&#39;</span>
)
</pre>

<p>To list all the available jobs:</p>

<pre class="ruby"><span class="ruby-identifier">jobs</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">job</span>.<span class="ruby-identifier">list</span>
<span class="ruby-identifier">jobs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">job</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;[%10s] #{job[&#39;name&#39;]}&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">job</span>[<span class="ruby-string">&#39;color&#39;</span>]]
<span class="ruby-keyword">end</span>
</pre>

<p>List all node:</p>

<pre class="ruby"><span class="ruby-identifier">nodes</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">node</span>.<span class="ruby-identifier">all</span>
<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Total Executors: #{nodes[&#39;totalExecutors&#39;]}&quot;</span>
<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Busy Executors: #{nodes[&#39;busyExecutors&#39;]}&quot;</span>

<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Executors:&quot;</span>
<span class="ruby-identifier">nodes</span>[<span class="ruby-string">&#39;computer&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">computer</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">type</span> = <span class="ruby-string">&#39;slave&#39;</span>
  <span class="ruby-identifier">type</span> = <span class="ruby-string">&#39;master&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">computer</span>[<span class="ruby-string">&#39;_class&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;hudson.model.Hudson$MasterComputer&#39;</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;  [%7s] #{computer[&#39;displayName&#39;]}&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">type</span>]
<span class="ruby-keyword">end</span>
</pre>

<p>Get a specific job&#39;s latest build information:</p>

<pre class="ruby"><span class="ruby-identifier">build</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">build</span>.<span class="ruby-identifier">latest</span>(<span class="ruby-string">&#39;my-job&#39;</span>)

<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Latest build: #{build[&#39;id&#39;]}&quot;</span>
<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Result: #{build[&#39;result&#39;]}&quot;</span>
<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;URL: #{build[&#39;url&#39;]}&quot;</span>
<span class="ruby-identifier">logfiles</span> = <span class="ruby-identifier">build</span>[<span class="ruby-string">&#39;artifacts&#39;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">artifact</span><span class="ruby-operator">|</span> <span class="ruby-identifier">artifact</span>[<span class="ruby-string">&#39;fileName&#39;</span>].<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/.*\.xml$/</span>) }

<span class="ruby-identifier">slave_name</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">build</span>.<span class="ruby-identifier">slave_name</span>(<span class="ruby-string">&#39;my-job&#39;</span>, <span class="ruby-identifier">build</span>[<span class="ruby-string">&#39;id&#39;</span>])

<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Build on: #{slave_name}&quot;</span>
</pre>

<p>Process junit reports:</p>

<pre class="ruby"><span class="ruby-identifier">failed_tests</span> = []
<span class="ruby-identifier">logfiles</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">results</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-identifier">client</span>.<span class="ruby-identifier">artifact</span>.<span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;my-job&#39;</span>, <span class="ruby-identifier">build</span>[<span class="ruby-string">&#39;id&#39;</span>], <span class="ruby-identifier">file</span>))
  <span class="ruby-identifier">failed_tests</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">results</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-string">&#39;//testcase&#39;</span>).<span class="ruby-identifier">select</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">testcase</span><span class="ruby-operator">|</span>
    <span class="ruby-operator">!</span><span class="ruby-identifier">testcase</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Failed tests:&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">failed_tests</span>.<span class="ruby-identifier">empty?</span>
<span class="ruby-identifier">failed_tests</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">failed</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;  [✘] #{failed[&#39;name&#39;]} on #{failed[&#39;classname&#39;]}&quot;</span>
<span class="ruby-keyword">end</span>
</pre>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.1.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

